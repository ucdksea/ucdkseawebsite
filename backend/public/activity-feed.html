<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë³€í™” ì´ë ¥ | Activity Feed</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .focus-ring:focus{outline:3px solid rgba(57,84,166,.45); outline-offset:2px}
    .badge{border-radius:9999px; font-weight:600; font-size:.75rem; padding:.125rem .5rem}
    .dot{width:.5rem;height:.5rem;border-radius:9999px}
    .diff del{background:#fee2e2;color:#991b1b;text-decoration:none;padding:0 .2rem;border-radius:.25rem}
    .diff ins{background:#dcfce7;color:#166534;text-decoration:none;padding:0 .2rem;border-radius:.25rem}
    .truncate-2{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
  </style>
</head>

<body class="bg-slate-900 text-white min-h-dvh">
  <!-- í—¤ë” -->
  <header class="top-1 z-10 bg-[#0F172A]/60 backdrop-blur supports-[backdrop-filter]:bg-[#0F172A]/40">
    <div class="mx-auto max-w-6xl px-4 py-6 flex items-center justify-between">
      <a href="/" class="inline-flex items-center gap-2 hover:opacity-90" aria-label="Go to home">
        <img src="/images/kseaicon/ksealogo_white.png" alt="KSEA logo" class="h-7 w-auto"/>
        <span class="hidden sm:inline font-semibold tracking-wide">UC DAVIS KSEA</span>
      </a>
      <nav class="hidden md:flex gap-6 text-sm font-medium">
        <a href="/post" class="hover:text-blue-400 transition">Post</a>
        <a href="/history" class="hover:text-blue-400">History</a>
        <a href="/log" class="text-blue-400 transition">Log</a>
      </nav>
    </div>
  </header>
<!-- Top Bar -->
<div class="rounded-2xl bg-slate-800/60 border border-white/10 backdrop-blur p-5 max-w-[70rem] mx-auto px-4 py-4">  <div class="flex items-center">
    <!-- Left: icon + title -->
    <div class="flex items-center gap-3">
      <svg width="26" height="26" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M3 12a9 9 0 1018 0 9 9 0 10-18 0zm6.5 0a2.5 2.5 0 105 0 2.5 2.5 0 10-5 0z" stroke="currentColor" stroke-width="1.5"/>
      </svg>
      <div class="flex items-baseline gap-3">
        <h1 class="text-lg sm:text-xl font-semibold text-white">ë¡œê·¸</h1>
        <span class="text-xs text-slate-400">/ Log</span>
      </div>
    </div>

    <!-- Spacer to push buttons to the right -->
    <div class="flex-1"></div>

    <!-- Right: actions -->
    <div class="flex items-center gap-2">
      <button id="btn-export" class="focus-ring inline-flex items-center gap-2 rounded-xl px-3 py-1.5 text-sm bg-slate-900 text-white hover:bg-slate-800">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M12 3v12m0 0l-4-4m4 4l4-4M5 21h14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        CSV ë‚´ë³´ë‚´ê¸°
      </button>
      <button id="btn-refresh" class="focus-ring inline-flex items-center gap-2 rounded-xl px-3 py-1.5 text-sm bg-slate-700 text-slate-100 hover:bg-slate-600">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M4 4v6h6M20 20v-6h-6M20 8a8 8 0 00-7-4 8 8 0 00-8 8m14 4a8 8 0 01-7 4 8 8 0 01-8-8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        ìƒˆë¡œê³ ì¹¨
      </button>
    </div>
  </div>
</div>

  <main class="mx-auto max-w-6xl px-4 py-6 text-slate-100">
    <!-- Filters -->
    <section class="mb-4">
      <div class="grid grid-cols-1 md:grid-cols-12 gap-3">
        <div class="md:col-span-2">
          <label class="block text-xs font-medium text-slate-300 mb-1">ì•¡ì…˜</label>          
          <select id="f-action" class="w-full rounded-xl border-slate-700 focus-ring px-3 py-2 text-sm bg-slate-800 text-slate-100">
            <option value="">ëª¨ë‘</option>
            <option value="CREATE">CREATE</option>
            <option value="UPDATE">UPDATE</option>
            <option value="DELETE">DELETE</option>
            <option value="APPROVE">APPROVE</option>
            <option value="REJECT">REJECT</option>
            <option value="ASSIGN">ASSIGN</option>
          </select>
        </div>
        <div class="md:col-span-2">
          <label class="block text-xs font-medium text-slate-600 mb-1">ëŒ€ìƒ íƒ€ì…</label>
          <select id="f-target" class="w-full rounded-xl border-slate-700 focus-ring px-3 py-2 text-sm bg-slate-800 text-slate-100">
            <option value="">ëª¨ë‘</option>
            <option>POST</option>
            <option>USER</option>
            <option>ROLE</option>
            <option>PERMISSION</option>
            <option>QUOTE</option>
            <option>PRODUCT</option>
          </select>
        </div>
        <div class="md:col-span-3">
          <label class="block text-xs font-medium text-slate-600 mb-1">ê¸°ê°„ ì‹œì‘</label>
          <input id="f-start" type="datetime-local" class="w-full rounded-xl border-slate-700 focus-ring px-3 py-2 text-sm bg-slate-800 text-slate-100" />

        </div>
        <div class="md:col-span-3">
          <label class="block text-xs font-medium text-slate-600 mb-1">ê¸°ê°„ ì¢…ë£Œ</label>
          <input id="f-end" type="datetime-local" class="w-full rounded-xl border-slate-700 focus-ring px-3 py-2 text-sm bg-slate-800 text-slate-100" />

        </div>
        <div class="md:col-span-2">
          <label class="block text-xs font-medium text-slate-600 mb-1">ì‚¬ìš©ì</label>
          <input id="f-user" placeholder="ì˜ˆ: stephanie" class="w-full rounded-xl border-slate-700 focus-ring px-3 py-2 text-sm bg-slate-800 text-slate-100" />
        </div>
      </div>
      <div class="mt-2 flex items-center gap-4">
        <div class="relative w-full md:w-auto md:min-w-[320px]">
          <input id="f-q" placeholder="ê²€ìƒ‰: ì œëª©, ì„¤ëª…, ë³€ê²½í•„ë“œ, IP, ìš”ì²­ID" class="w-full rounded-xl border-slate-300 focus-ring pl-9 pr-3 py-2 text-sm bg-slate-800" />
          <svg class="absolute left-2 top-1/2 -translate-y-1/2" width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 100-15 7.5 7.5 0 000 15z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
        </div>
        <label class="inline-flex items-center gap-2 text-sm select-none">
          <input id="f-auto" type="checkbox" class="rounded border-slate-300" /> 10ì´ˆë§ˆë‹¤ ìë™ ê°±ì‹ 
        </label>
        <span id="last-updated" class="text-xs text-slate-400">â€”</span>
      </div>
    </section>

    <!-- Grouped Timeline -->
    <section id="timeline" class="space-y-6">
      <!-- ê·¸ë£¹(ë‚ ì§œ)ì™€ í•­ëª©ì´ JSë¡œ ì‚½ì…ë¨ -->
    </section>

    <!-- Pager -->
    <div class="flex items-center justify-between gap-3 mt-6">
      <div class="text-xs text-slate-500">í˜ì´ì§€ <span id="page">1</span> / <span id="pages">1</span> â€¢ ì „ì²´ <span id="total">0</span>ê±´</div>
      <div class="flex items-center gap-2">
        <button id="prev" class="focus-ring rounded-xl border border-slate-700 bg-slate-800 px-3 py-1.5 text-sm text-slate-100 hover:bg-slate-700 disabled:opacity-50">ì´ì „</button>
        <button id="next" class="focus-ring rounded-xl border border-slate-700 bg-slate-800 px-3 py-1.5 text-sm text-slate-100 hover:bg-slate-700 disabled:opacity-50">ë‹¤ìŒ</button>
      </div>
    </div>
  </main>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 z-50 hidden"><div class="rounded-xl bg-slate-900 text-white text-sm px-3 py-2 shadow-lg">ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤</div></div>
  <footer class="mt-10 border-t border-white/10">
    <div class="mx-auto max-w-6xl px-4 py-6 text-center text-sm text-white/60">
      Â© 2025 KSEA Sacramento chapter â€” <a href="/" class="underline">UCD KSEA</a>
    </div>
  </footer>

  <script>
    const API_BASE = "https://api.ucdksea.com";
    const API = `${API_BASE}/api/activity`;   // ğŸ‘ˆ ì ˆëŒ€ê²½ë¡œë¡œ ë³€ê²½
    fetch(`${API_BASE}/healthz`, { credentials: "include" }); // ìˆìœ¼ë©´ /healthzê°€ ë” ê°„ë‹¨
  const PAGE_SIZE = 20;
  let state = { page:1, pages:1, total:0, action:'', target:'', start:'', end:'', user:'', q:'', auto:false };
  let timer = null; let aborter = null; let bound=false;

  const $ = (s)=>document.querySelector(s);
  const h = (str)=>String(str).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]));
  const qs = (o)=>Object.entries(o).filter(([,v])=>v!==''&&v!=null).map(([k,v])=>`${encodeURIComponent(k)}=${encodeURIComponent(v)}`).join('&');
  const debounce=(f,m=300)=>{let t;return(...a)=>{clearTimeout(t);t=setTimeout(()=>f(...a),m)}};
  const fmtDate=(iso)=>{try{const d=new Date(iso);return d.toLocaleString()}catch{return iso}}

  const ACTION_COLOR={CREATE:'bg-emerald-100 text-emerald-700',UPDATE:'bg-amber-100 text-amber-700',DELETE:'bg-rose-100 text-rose-700',APPROVE:'bg-indigo-100 text-indigo-700',REJECT:'bg-fuchsia-100 text-fuchsia-700',ASSIGN:'bg-sky-100 text-sky-700'};

  function groupByDate(items){
    const map = new Map();
    for(const it of items){
      const d = new Date(it.timestamp);
      const key = d.toISOString().slice(0,10); // YYYY-MM-DD
      if(!map.has(key)) map.set(key, []);
      map.get(key).push(it);
    }
    return Array.from(map.entries()).sort((a,b)=>a[0]<b[0]?1:-1);
  }

  function render(list, resp){
    const root = $('#timeline'); root.innerHTML='';
    const groups = groupByDate(list);

    if(groups.length===0){
      root.innerHTML = '<div class="text-center text-slate-500 py-12">í‘œì‹œí•  ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
    }

    for(const [date, items] of groups){
      const wrap = document.createElement('div');
      wrap.innerHTML = `
        <div class="flex items-start gap-3">
          <div class="mt-1 text-sm font-semibold text-slate-300 w-28 shrink-0">${date}</div>
          <ol class="relative border-l border-slate-700 pl-5 space-y-6 w-full">
          </ol>
        </div>`;
      const ol = wrap.querySelector('ol');

      for(const it of items){
        const li = document.createElement('li');
        li.innerHTML = `
          <span class="absolute -left-[4.5px] top-[0.575rem] flex items-center justify-center dot bg-slate-900 border border-slate-300"></span>
          <div class="rounded-2xl border border-slate-900 bg-slate-800 p-4">
            <div class="flex flex-wrap items-center gap-2 justify-between text-slate-100">
              <div class="flex items-center gap-3">
                <img src="${h(it.actor_avatar||'https://api.dicebear.com/9.x/thumbs/svg?seed='+encodeURIComponent(it.actor||'u'))}" alt="avatar" class="w-7 h-7 rounded-full border border-slate-600"/>                <div class="text-sm">
                  <div class="font-semibold text-slate-100">${h(it.actor||'Unknown')}</div>
                  <div class="text-xs text-slate-400">${fmtDate(it.timestamp)} â€¢ IP ${h(it.ip||'-')} â€¢ ${h(it.request_id||'â€”')}</div>
                </div>
              </div>
              <span class="badge ${ACTION_COLOR[it.action]||'bg-slate-700 text-slate-100'}">${h(it.action)}</span>
            </div>

            <div class="mt-3 text-sm">
              <div class="text-slate-200">
                <strong class="text-slate-100">${h(it.target_type)}</strong>
                <span class="text-slate-400">#${h(it.target_id||'â€”')}</span>
                ${it.title?`<span class="mx-1">Â·</span><span class="font-medium">${h(it.title)}</span>`:''}
              </div>
              ${it.summary?`<div class="text-slate-300 mt-1 truncate-2">${h(it.summary)}</div>`:''}
            </div>

            ${renderChanges(it.changes)}

            <div class="mt-3 flex flex-wrap items-center gap-2">
              ${it.labels?.map(l=>`<span class="badge bg-slate-700 text-slate-100">${h(l)}</span>`).join('')||''}
              <div class="ml-auto space-x-2 text-xs">
                ${it.diff_before || it.diff_after ? '<button class="focus-ring rounded-lg border border-slate-600 bg-slate-800 text-slate-100 hover:bg-slate-700 px-2 py-1" data-action="toggle-diff">DIFF</button>' : ''}
                ${it.meta ? '<button class="focus-ring rounded-lg border border-slate-600 bg-slate-800 text-slate-100 hover:bg-slate-700 px-2 py-1" data-action="copy-json">JSON ë³µì‚¬</button>' : ''}
              </div>
            </div>

            <div class="mt-3 hidden" data-detail="diff">
              ${renderDiff(it)}
            </div>
          </div>`;
        li.__item = it;
        ol.appendChild(li);
      }

      root.appendChild(wrap);
    }

    // footer / pager
    state.page = Number(resp.page||1);
    state.total = Number(resp.total||list.length||0);
    state.pages = Math.max(1, Math.ceil(state.total / (resp.page_size || PAGE_SIZE)));
    $('#page').textContent = String(state.page);
    $('#pages').textContent = String(state.pages);
    $('#total').textContent = String(state.total);
    $('#last-updated').textContent = 'ì—…ë°ì´íŠ¸: ' + new Date().toLocaleString();
  }

  function renderChanges(changes){
    if(!changes || !changes.length) return '';
    const rows = changes.slice(0,6).map(c=>`<li class="flex items-center gap-2 text-sm"><span class="dot ${c.kind==='add'?'bg-emerald-400':c.kind==='remove'?'bg-rose-400':'bg-amber-400'}"></span><span class="text-slate-200">${h(c.field)}</span><span class="text-slate-400">â†’</span><span class="text-slate-300 font-medium">${h(String(c.to))}</span>${c.more?'<span class="text-slate-300"> (+'+c.more+')</span>':''}</li>`).join('');
    return `<ul class="mt-3 space-y-1">${rows}</ul>`;
  }

  function renderDiff(it){
    if(!(it.diff_before || it.diff_after)) return '';
    return `<div class="rounded-xl border border-slate-200 bg-slate-50 p-3 text-xs diff overflow-auto"><pre>${h(makeUnifiedDiff(it.diff_before||'', it.diff_after||''))}</pre></div>`;
  }

  function makeUnifiedDiff(a,b){
    // ë§¤ìš° ë‹¨ìˆœí•œ ì¤„ë‹¨ìœ„ diff (MVP)
    const A=a.split(/\r?\n/), B=b.split(/\r?\n/);
    const max=Math.max(A.length,B.length); let out='';
    for(let i=0;i<max;i++){
      if(A[i]===B[i]) out += '  ' + (A[i]||'') + '\n';
      else{
        if(A[i]!==undefined) out += '- ' + A[i] + '\n';
        if(B[i]!==undefined) out += '+ ' + B[i] + '\n';
      }
    }
    // ì‹œê° ê°•ì¡°ë¥¼ ìœ„í•´ <ins>/<del> ì¹˜í™˜
    return out.replace(/^\-\s(.+)$/gm,'<del>$1<\/del>').replace(/^\+\s(.+)$/gm,'<ins>$1<\/ins>');
  }

  async function fetchList(){
    if (aborter) aborter.abort();
    aborter = new AbortController();
    const params={page:state.page,page_size:PAGE_SIZE,action:state.action,target:state.target,user:state.user,q:state.q,start:state.start,end:state.end,order:'desc'};
    const url = API + '?' + qs(params);
    try{
      const res = await fetch(url,{signal:aborter.signal,headers:{'Accept':'application/json'}});
      if(!res.ok) throw new Error('HTTP '+res.status);
      const json = await res.json();
      render(json.data||[], json);
    }catch(e){
      console.warn('[activity] mock fallback:', e?.message||e);
      const mock = buildMock(state.page, PAGE_SIZE, state);
      render(mock.data, mock);
    }
  }

  function bind(){
    if(bound) return; bound=true;
    $('#f-action').addEventListener('change',()=>{state.action=$('#f-action').value;state.page=1;fetchList()});
    $('#f-target').addEventListener('change',()=>{state.target=$('#f-target').value;state.page=1;fetchList()});
    $('#f-user').addEventListener('input',debounce(()=>{state.user=$('#f-user').value.trim();state.page=1;fetchList()},300));
    $('#f-q').addEventListener('input',debounce(()=>{state.q=$('#f-q').value.trim();state.page=1;fetchList()},300));
    $('#f-start').addEventListener('change',()=>{state.start=$('#f-start').value?new Date($('#f-start').value).toISOString():'';state.page=1;fetchList()});
    $('#f-end').addEventListener('change',()=>{state.end=$('#f-end').value?new Date($('#f-end').value).toISOString():'';state.page=1;fetchList()});
    $('#f-auto').addEventListener('change',(e)=>{state.auto=e.target.checked; if(state.auto){if(timer)clearInterval(timer); timer=setInterval(fetchList,10000)} else {if(timer)clearInterval(timer)}});
    $('#prev').addEventListener('click',()=>{if(state.page>1){state.page--;fetchList()}});
    $('#next').addEventListener('click',()=>{if(state.page<state.pages){state.page++;fetchList()}});
    $('#btn-refresh').addEventListener('click',fetchList);

    // ë¸ë¦¬ê²Œì´ì…˜: diff í† ê¸€ & JSON ë³µì‚¬
    $('#timeline').addEventListener('click', (e)=>{
      const btn = e.target.closest('button'); if(!btn) return;
      const li = e.target.closest('li'); if(!li) return; const it = li.__item;
      if(btn.dataset.action==='toggle-diff'){
        const box = li.querySelector('[data-detail="diff"]'); box.classList.toggle('hidden');
      } else if(btn.dataset.action==='copy-json'){
        navigator.clipboard.writeText(JSON.stringify(it,null,2)).then(()=>toast('JSON ë³µì‚¬ë¨'));
      }
    });

    // CSV export (í˜„ì¬ í˜ì´ì§€)
    $('#btn-export').addEventListener('click',()=>{
      const items = Array.from(document.querySelectorAll('#timeline li')).map(li=>li.__item).filter(Boolean);
      exportCSV(items);
    })
  }

  function exportCSV(items){
    if(!items.length) return toast('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤');
    const headers=['timestamp','action','actor','target_type','target_id','title','summary','ip','request_id'];
    const rows = items.map(x=>headers.map(k=>String(x[k]??'' ).replaceAll('"','""')));
    const csv = [headers, ...rows].map(r=>r.map(c=>'"'+c+'"').join(',')).join('\n');
    const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'}); const url=URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download=`activity_page${state.page}.csv`; a.click(); URL.revokeObjectURL(url);
  }

  function toast(msg){ const t=$('#toast'); t.firstElementChild.textContent=msg; t.classList.remove('hidden'); setTimeout(()=>t.classList.add('hidden'),1200); }

  function init(){ bind(); fetchList(); document.addEventListener('visibilitychange',()=>{ if(document.hidden){if(timer)clearInterval(timer)} else if(state.auto){timer=setInterval(fetchList,10000)} }); }
  document.addEventListener('DOMContentLoaded', init, {once:true});

  // MOCK for preview
  const TITLES=['íšŒì›ê°€ì… ì–‘ì‹','ë™ì•„ë¦¬ ê³µì§€','ê°€ì„ í–‰ì‚¬','ì œí’ˆ A','ì œí’ˆ B','ê²¬ì  #1023','ê¶Œí•œ ì •ì±…'];
  function buildMock(page=1, pageSize=20, s={}){
    const total=356; const startIdx=(page-1)*pageSize; const data=[];
    for(let i=0;i<pageSize;i++){
      const ts = new Date(Date.now() - (startIdx+i)*3600*1000 + Math.random()*300000).toISOString();
      const action = s.action || ['CREATE','UPDATE','DELETE','APPROVE','ASSIGN'][Math.floor(Math.random()*5)];
      const target = s.target || ['POST','USER','ROLE','PERMISSION','QUOTE','PRODUCT'][Math.floor(Math.random()*6)];
      const item = {
        id:'mock-'+(startIdx+i+1),
        timestamp: ts,
        action,
        actor: ['stephanie','admin','manager','system'][Math.floor(Math.random()*4)],
        actor_avatar: '',
        target_type: target,
        target_id: Math.floor(1000+Math.random()*9000),
        title: TITLES[Math.floor(Math.random()*TITLES.length)],
        summary: action==='CREATE'? 'ìƒˆ í•­ëª©ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.' : action==='DELETE'? 'í•­ëª©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.' : 'í•„ë“œê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.',
        labels: target==='QUOTE' ? ['Finance','High Risk'] : (action==='APPROVE'?['Approval'] : []),
        changes: action==='UPDATE' ? [
          {field:'title', kind:'change', to:'ê°€ì„ í–‰ì‚¬(ìˆ˜ì •)'},
          {field:'status', kind:'change', to:'APPROVED'}
        ] : action==='CREATE' ? [{field:'title', kind:'add', to:'ìƒˆ ê³µì§€'}] : [],
        diff_before: action==='UPDATE' ? 'title: ê°€ì„ í–‰ì‚¬\nstatus: DRAFT' : '',
        diff_after:  action==='UPDATE' ? 'title: ê°€ì„ í–‰ì‚¬(ìˆ˜ì •)\nstatus: APPROVED' : '',
        ip: ['203.0.113.5','198.51.100.7','192.0.2.9'][Math.floor(Math.random()*3)],
        request_id: 'req_'+Math.random().toString(36).slice(2,8),
        meta: { method:'POST', path:'/api/admin/posts' }
      };
      data.push(item);
    }
    const filtered = data.filter(x=>(!s.user || x.actor.includes(s.user)) && (!s.q || JSON.stringify(x).toLowerCase().includes(s.q.toLowerCase())));
    return { data: filtered, total, page, page_size: pageSize };
  }
  </script>

  <!--
  ==========================================
  âœ… ë°±ì—”ë“œ ì—°ë™ ë©”ëª¨ (/api/activity)
  ==========================================
  ê¸°ëŒ€ ì‘ë‹µ ìŠ¤í‚¤ë§ˆ
  {
    data: Array<{
      id: string,
      timestamp: string,      // ISO8601
      action: 'CREATE'|'UPDATE'|'DELETE'|'APPROVE'|'REJECT'|'ASSIGN',
      actor: string,          // ì´ë©”ì¼/ì•„ì´ë”” í‘œì‹œ ê¶Œì¥
      actor_avatar?: string,  // ì„ íƒ
      target_type: string,    // POST | USER | ROLE | ...
      target_id?: string|number,
      title?: string,         // ëŒ€ìƒ í‘œì‹œëª…
      summary?: string,       // í•œ ì¤„ ì„¤ëª… (ì˜ˆ: "í•„ë“œ 3ê°œ ë³€ê²½")
      changes?: Array<{field:string, kind:'add'|'remove'|'change', to:any, more?:number}>,
      diff_before?: string,   // ì¤„ë‹¨ìœ„ diff ìš© ì›ë³¸
      diff_after?: string,    // ì¤„ë‹¨ìœ„ diff ìš© ë³€ê²½ë³¸
      labels?: string[],
      ip?: string,
      request_id?: string,
      meta?: Record<string, any>
    }>,
    page: number,
    page_size: number,
    total: number
  }

  ì˜ˆì‹œ Next.js(App Router): app/api/activity/route.ts
  import { NextResponse } from 'next/server'

  export async function GET(req: Request){
    const url = new URL(req.url)
    const page = Number(url.searchParams.get('page')||'1')
    const pageSize = Number(url.searchParams.get('page_size')||'20')
    const action = url.searchParams.get('action')||''
    const target = url.searchParams.get('target')||''
    const user = url.searchParams.get('user')||''
    const q = (url.searchParams.get('q')||'').toLowerCase()
    const start = url.searchParams.get('start')
    const end = url.searchParams.get('end')

    // TODO ì‹¤ì œ DBì—ì„œ ì¡°íšŒ. Demo rows:
    let rows = Array.from({length:300}, (_,i)=>({
      id:'id_'+i,
      timestamp:new Date(Date.now()-i*3600*1000).toISOString(),
      action:['CREATE','UPDATE','DELETE','APPROVE','ASSIGN'][i%5],
      actor:['stephanie','admin','system'][i%3],
      target_type:['POST','USER','ROLE','QUOTE','PRODUCT'][i%5],
      target_id:1000+i,
      title:'ìƒ˜í”Œ í•­ëª© '+i,
      summary:'í•„ë“œ '+(i%3+1)+'ê°œ ë³€ê²½',
      ip:'203.0.113.'+(i%255), request_id:'req_'+i,
      diff_before:i%5===1?'status: DRAFT':'',
      diff_after:i%5===1?'status: APPROVED':'',
      changes:i%5===1?[{field:'status',kind:'change',to:'APPROVED'}]:[]
    }))

    if(action) rows = rows.filter(r=>r.action===action)
    if(target) rows = rows.filter(r=>r.target_type===target)
    if(user) rows = rows.filter(r=>r.actor?.includes(user))
    if(start) rows = rows.filter(r=>new Date(r.timestamp)>=new Date(start))
    if(end) rows = rows.filter(r=>new Date(r.timestamp)<=new Date(end))
    if(q) rows = rows.filter(r=>JSON.stringify(r).toLowerCase().includes(q))

    const total = rows.length
    const startIdx=(page-1)*pageSize
    const data = rows.slice(startIdx, startIdx+pageSize)
    return NextResponse.json({ data, page, page_size: pageSize, total })
  }
  -->
</body>
</html>